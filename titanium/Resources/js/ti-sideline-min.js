/**
 * Copyright (c) 2008-2009 Yahoo! Inc.  All rights reserved.  
 * The copyrights embodied in the content of this file are licensed by Yahoo! Inc. under 
 * the BSD (revised) open source license.
 */
YAHOO.util.Event.onDOMReady(function(){YAHOO.namespace("TI");YAHOO.TI.Sideline=function(){var a,c=0,b=0};YAHOO.TI.Sideline.prototype={tabView:null,tabStore:[],showDesktopNotifications:null,searchRefreshRate:null,desktopNotificationLoader:null,setupMenu:function(){var a=this;YAHOO.util.Event.onContentReady("options_menu",function(){function d(g,f,i){var h=this.cfg.getProperty("checked"),e=this.value;if(e==="notification"){this.cfg.setProperty("checked",!h);a.showDesktopNotifications=Number(!h);a.saveUserPreferences()}else{if(e==="import"){alert("Search group import not implemented yet...")}else{if(e==="help"){a.openInBrowser("http://sideline.yahoo.com/help.php")}else{if(e==="rate"){a.searchRateDialog.show()}}}}}var b=[{text:"Import Search Groups",value:"import",onclick:{fn:d}},{text:"Show Notifications",value:"notification",checked:!!a.showDesktopNotifications,onclick:{fn:d}},{text:"Adjust Refresh Rate",value:"rate",onclick:{fn:d}},{text:"Help",value:"help",onclick:{fn:d}}];var c=new YAHOO.widget.Button({type:"menu",label:"Options",name:"menubutton",menu:b,container:this})})},searchDialogBuilder:function(){var c=this;var a=function(){var u=this;var g,l=this.getData(),o=c.stripTags(YAHOO.lang.trim(l.title_of_search)),h=c.processSearchDialogData(l.q),t=c.processSearchDialogData(l.ands),j=c.processSearchDialogData(l.phrase),m=c.processSearchDialogData(l.ors),f=c.processSearchDialogData(l.nots),v=c.processSearchDialogData(l.tag),s=c.processSearchDialogData(l.from),r=c.processSearchDialogData(l.to),i=c.processSearchDialogData(l.ref),p=l.pa,n=l.na,k=l.aq;if(v.charAt(0)==="#"){v=v.substr(1,v.length)}if(s.charAt(0)==="@"){s=s.substr(1,s.length)}if(r.charAt(0)==="@"){r=r.substr(1,r.length)}if(i.charAt(0)==="@"){i=i.substr(1,i.length)}if(o===""){alert("You must provide a title for this search query!");return false}else{if(h===""&&t===""&&j===""&&m===""&&f===""&&v===""&&s===""&&r===""&&i===""&&p===false&&n===false&&k===false){alert("You must enter a valid search query!  Please try again.");return false}else{g="q="+h+"&ands="+t+"&phrase="+j+"&ors="+m+"&nots="+f+"&tag="+v+"&from="+s+"&to="+r+"&ref="+i+"&rpp="+100;if(p===true){g+="&tude[]=:)"}if(n===true){g+="&tude[]=:("}if(k===true){g+="&tude[]=?"}p=""+p+"";n=""+n+"";k=""+k+"";var e=YAHOO.util.Dom.get("search_to_update").value;c.getCurrentGrpId(function(w){var q={group_id:w,search_title:o,actual_query_string:g,q:h,ands:t,ors:m,nots:f,phrase:j,tag:v,user_from:s,user_to:r,ref:i,pa:p,na:n,aq:k};if(e===""){c.addSearchItem(q,function(A){if(A.rows!==null){var x=c.create("li");x.id="search__"+A.rows.item(0).id;YAHOO.util.Dom.addClass(x,"search_string_item");x.innerHTML=o;var y=YAHOO.util.Dom.getElementsByClassName("search_string_item","li","active_search_strings").length;var z=YAHOO.util.Dom.getLastChild("active_search_strings");YAHOO.util.Dom.insertAfter(x,z);if(y==="undefined"||y===0){var B=YAHOO.util.Dom.getFirstChild("active_search_strings");c.remove(B)}u.hide();YAHOO.util.Dom.get("add_search_form").reset()}else{alert("Unable to add new search string!  Please try again.")}})}else{c.updateSearchItem(e,q,function(){YAHOO.util.Dom.get("search__"+e).innerHTML=o;u.hide();c.removeSearchTermTweets(w,e);var x=YAHOO.util.Dom.get("summary-group-"+w);if(!x.hasChildNodes()){x.innerHTML='<p id="emptygroup__'+w+'">This group has no search results yet!</p>'}YAHOO.util.Dom.get("add_search_form").reset()})}setTimeout(function(){c.doIntermediateDataRotation.call(c)},1000)})}}};var d=function(){YAHOO.util.Dom.get("add_search_form").reset();this.cancel()};var b=function(){var g=YAHOO.util.Dom.get("search_to_update").value,f=YAHOO.util.Dom.getElementsByClassName("search_string_item","li","active_search_strings").length;if(g!==""){c.removeSearchItem(g);c.fadeThisOut(YAHOO.util.Dom.get("search__"+g),true);c.getCurrentGrpId(function(h){c.removeSearchTermTweets(h,g)});if(f==="undefined"||f<=1){var e=YAHOO.util.Dom.get("active_search_strings");e.innerHTML='<li class="list_message">This group has no searches defined!</li>'}YAHOO.util.Dom.get("add_search_form").reset();this.cancel()}};this.searchDialog=new YAHOO.widget.Dialog("add_search_dialog",{width:"435px",fixedcenter:true,visible:false,modal:true,draggable:false,underlay:"none",postmethod:"none",constraintoviewport:true,buttons:[{text:"Delete",handler:b},{text:"Submit",handler:a},{text:"Cancel",handler:d}]});this.searchDialog.render();YAHOO.util.Event.addListener("add_search_dialog","keypress",function(f){if(f.keyCode&&f.keyCode===13){YAHOO.util.Event.preventDefault(f)}});YAHOO.util.Event.addListener("add_search_form","click",function(g){var f=YAHOO.util.Event.getTarget(g),i=YAHOO.util.Dom.get("title_of_search"),h=i.value;if(f.id==="show_simple_search"){YAHOO.util.Event.preventDefault(g);YAHOO.util.Dom.get("add_search_form").reset();i.value=h;YAHOO.util.Dom.setStyle("advanced_search","display","none");YAHOO.util.Dom.setStyle("simple_search","display","")}else{if(f.id==="show_advanced_search"){YAHOO.util.Event.preventDefault(g);YAHOO.util.Dom.get("add_search_form").reset();i.value=h;YAHOO.util.Dom.setStyle("simple_search","display","none");YAHOO.util.Dom.setStyle("advanced_search","display","")}}})},searchGrpDialogBuilder:function(){var b=this;var a=function(){var e=this;var g=this.getData(),f=b.stripTags(YAHOO.lang.trim(g.search_group_title));if(f===""){alert("You must provide a title for this search group!");return false}else{var d;b.addNewSearchGroup(f,function(j){if(j.rows!==null){var h=j.rows.item(0);b.remove(YAHOO.util.Dom.get("add_new_group"));d=b.buildTabText(f);b.tabView.addTab(new YAHOO.widget.Tab({label:d,active:true,content:'<div id="summary-group-'+h.id+'" class="tweet-container summary-group-'+h.id+'"><p id="emptygroup__'+h.id+'">This group has no search results yet!</p><div>'}));b.setupNewTabButton();b.refreshTabStore();var i=YAHOO.util.Dom.get("active_search_strings");i.innerHTML='<li class="list_message">This group has no searches defined!</li>';e.hide();YAHOO.util.Dom.get("add_search_group_form").reset();YAHOO.util.Dom.setStyle("add_new_search","visibility","visible")}else{alert("Unable to add new Search Group!  Please try again.")}})}};var c=function(){YAHOO.util.Dom.get("add_search_group_form").reset();this.cancel()};this.searchGrpDialog=new YAHOO.widget.Dialog("add_search_group_dialog",{width:"250px",fixedcenter:true,visible:false,modal:true,draggable:false,underlay:"none",postmethod:"none",constraintoviewport:true,buttons:[{text:"Submit",handler:a},{text:"Cancel",handler:c}]});this.searchGrpDialog.render();YAHOO.util.Event.addListener("add_search_group_dialog","keypress",function(d){if(d.keyCode&&d.keyCode===13){YAHOO.util.Event.preventDefault(d)}})},renameSearchGrpDialogBuilder:function(){var b=this;var a=function(){var e=this;var h=this.getData(),d=b.stripTags(YAHOO.lang.trim(h.new_search_group_title)),g=b.stripTags(YAHOO.lang.trim(h.old_search_group_title));if(d===""||(d===g)){alert("You must provide a new title for this search group!");return false}else{var f=b.buildTabText(d);b.updateSearchGroup(g,d,function(i){b.tabStore[i].label=f;b.tabStore[i].nodeReference.innerHTML=f;b.refreshTabStore();e.hide();YAHOO.util.Dom.get("rename_search_group_form").reset()})}};var c=function(){YAHOO.util.Dom.get("rename_search_group_form").reset();this.cancel()};this.renameSearchGrpDialog=new YAHOO.widget.Dialog("rename_search_group_dialog",{width:"250px",fixedcenter:true,visible:false,modal:true,draggable:false,underlay:"none",postmethod:"none",constraintoviewport:true,buttons:[{text:"Submit",handler:a},{text:"Cancel",handler:c}]});this.renameSearchGrpDialog.render();YAHOO.util.Event.addListener("rename_search_group_dialog","keypress",function(d){if(d.keyCode&&d.keyCode===13){YAHOO.util.Event.preventDefault(d)}})},searchItemRemovalDialog:function(b,e){var d=this;var c=function(){d.removeSearchItem(b);d.fadeThisOut(e,true);this.hide()};var a=function(){this.hide()};this.searchItemRemoval=new YAHOO.widget.SimpleDialog("searchItemRemoval",{width:"300px",fixedcenter:true,visible:false,draggable:false,underlay:"none",modal:true,close:true,text:"Are you sure you want to remove this search item?",icon:YAHOO.widget.SimpleDialog.ICON_WARN,constraintoviewport:true,buttons:[{text:"Yes",handler:c},{text:"No",handler:a}]});this.searchItemRemoval.setHeader("Confirmation Dialog");this.searchItemRemoval.render("search_item_simpledialog")},searchGrpRemovalDialog:function(){var c=this;var b=function(){var d=YAHOO.util.Selector.query("li.selected a em"),e=d[0].innerHTML;if(e!=="Favorites"){c.getCurrentGrpId(function(h){var g="summary-group-"+h,f=YAHOO.util.Dom.get(g);if(h!=="undefined"){c.removeTabData(h);YAHOO.util.Event.purgeElement(f,true);c.tabStore[h].nodeReference=null;c.tabView.removeTab(c.tabView.get("activeTab"))}})}else{alert("The favorites group cannot be removed!")}this.hide();c.refreshTabStore()};var a=function(){this.hide()};this.searchGrpRemoval=new YAHOO.widget.SimpleDialog("searchGrpRemoval",{width:"300px",fixedcenter:true,visible:false,draggable:false,underlay:"none",modal:true,close:true,text:"Are you sure you want to remove this search group?",icon:YAHOO.widget.SimpleDialog.ICON_WARN,constraintoviewport:true,buttons:[{text:"Yes",handler:b},{text:"No",handler:a}]});this.searchGrpRemoval.setHeader("Confirmation Dialog");this.searchGrpRemoval.render("search_item_simpledialog")},setupSidelineTabs:function(){var a=this;this.getAllSidelineGroups(function(d){a.tabView.addTab(new YAHOO.widget.Tab({label:a.buildTabText("Trends"),active:false,content:'<div id="trending_content" class="tweet-container"><p>Popular topics right now</p><div id="twitter_trend_list"><p>Loading trends...<img src="images/search_in_progress.gif" alt="loading" /></p></div><p id="twitter_trend_asof"></p></div>'}));for(var c=0;c<d.rows.length;c++){a.getTweets(d.rows.item(c).id,function(o,h){var k="",e=[],n="";e[e.length]='<div id="summary-group-'+h.id+'" class="tweet-container summary-group-'+h.id+'">';if(o.rows.length>0){var p=0,m,i=o.rows.length;for(m=0;m<i;m++){var g=o.rows.item(m);var q,f,l;if(h.group_name==="Favorites"){q="delete_button";f="remove";l="Remove this Tweet"}else{q="fav_button";f="fav";l="Favorite this Tweet"}e[e.length]='<div class="single-tweet search-term-'+g.searches_id+" detail-group-"+h.id+'" id="tweet__'+g.id+"__"+g.twitter_id+'">';e[e.length]='<div class="tweet-container-left">';e[e.length]='<img height="48" width="48" class="profile_image" src="'+g.profile_image_url+'" alt="'+g.from_user+'" />';e[e.length]="</div>";e[e.length]='<div class="tweet-container-center">';e[e.length]='<p class="tweet_text" id="db_'+g.id+'">';e[e.length]='<a title="open in browser" style="text-decoration: underline;" class="tweet_link" href="http://twitter.com/'+encodeURIComponent(g.from_user)+'">'+g.from_user+"</a>&nbsp;"+g.text;e[e.length]="</p>";e[e.length]='<p class="tweet-date">'+g.created_at+"</p>";e[e.length]="</div>";e[e.length]='<div class="tweet-container-right">';e[e.length]='<span title="'+l+'" class="fav_reply_remove '+q+'" id="'+f+"__"+g.twitter_id+"__"+g.from_user+'"></span>';e[e.length]='<span title="Reply to Tweet" class="fav_reply_remove reply_button" id="reply__'+g.twitter_id+"__"+g.from_user+'"></span>';e[e.length]="</div>";e[e.length]='<br class="clear" />';e[e.length]="</div>"}}else{e[e.length]='<p id="emptygroup__'+h.id+'">This group has no search results yet!</p>'}e[e.length]="</div>";k=e.join("");n=a.buildTabText(h.group_name);a.tabView.addTab(new YAHOO.widget.Tab({label:n,content:k,active:false}))},d.rows.item(c))}a.tabView.appendTo("tweetainer");var b=Number(d.rows.length)*500;setTimeout(function(){a.refreshTabStore();a.setupNewTabButton();a.tabView.addListener("activeTabChange",function(f){a.getCurrentGrpId(function(e){if(e!=="undefined"){a.getSidelineGroupQueries(e,function(h){if(h===null){h="undefined"}var g=YAHOO.util.Dom.get("active_search_strings");if(e===a.tabStore.favoritesGrpID){YAHOO.util.Dom.replaceClass(YAHOO.util.Dom.get("favs-tab-label"),"inactive","active");YAHOO.util.Dom.replaceClass(YAHOO.util.Dom.get("trends-tab-label"),"active","inactive");YAHOO.util.Dom.setStyle("add_new_search","visibility","hidden");g.innerHTML='<li class="list_message">The Favorites group does not contain specific search items. Instead it contains a collection of your favorite search results.</li>';YAHOO.util.Dom.get("search_group_result_count").innerHTML=""}else{if(e===a.tabStore.trendsGrpID){YAHOO.util.Dom.replaceClass(YAHOO.util.Dom.get("trends-tab-label"),"inactive","active");YAHOO.util.Dom.replaceClass(YAHOO.util.Dom.get("favs-tab-label"),"active","inactive");YAHOO.util.Dom.setStyle("add_new_search","visibility","hidden");g.innerHTML='<li class="list_message">The Trends group does not contain specific search items. Instead it contains a collection of topics currently trending in Twitter.</li>';YAHOO.util.Dom.get("search_group_result_count").innerHTML=""}else{YAHOO.util.Dom.replaceClass(YAHOO.util.Dom.get("favs-tab-label"),"active","inactive");YAHOO.util.Dom.replaceClass(YAHOO.util.Dom.get("trends-tab-label"),"active","inactive");YAHOO.util.Dom.setStyle("add_new_search","visibility","visible");if(h!=="undefined"){a.updateActiveSearchList(h)}a.tabStore[e].newTweetCount=0;a.tabStore[e].nodeReference.innerHTML=a.buildTabText(a.tabStore[e].label,0);YAHOO.util.Dom.get("search_group_result_count").innerHTML="Search Group Total: "+a.tabStore[e].totalTweetCount}}})}})});a.tabView.set("activeIndex",0)},b)})},setupNewTabButton:function(){var b,a=YAHOO.util.Dom.getLastChild(YAHOO.util.Dom.getElementsByClassName("yui-nav","ul","tweetainer")[0]);b=this.create("img");b.id="add_new_group";b.src="images/add_search_group.png";YAHOO.util.Dom.addClass(b,"new-tab-button");YAHOO.util.Dom.insertAfter(b,a);YAHOO.util.Event.on("add_new_group","click",function(){this.searchGrpDialog.show()},this,true)},doIntermediateDataRotation:function(){var a=this;clearInterval(this.rotationTimer);if(!YAHOO.lang.isNull(this.desktopNotificationLoader)){}this.dataRotation();this.rotationTimer=setInterval(function(){a.doIntermediateDataRotation.call(a)},a.searchRefreshRate*60000)},activeSearchHandler:function(f){var d=this;var b=YAHOO.util.Event.getTarget(f);if(YAHOO.util.Dom.hasClass(b,"search_string_item")){var c=b.id.split("__"),a=c[1];this.restoreSearchItemDialog(a);this.searchDialog.show()}else{if(b.id==="add_new_search"){this.getCurrentGrpId(function(e){if(e!=="undefined"){if(e===this.tabStore.favoritesGrpID||e===d.tabStore.trendsGrpID){alert("You cannot define search conditions for this group!")}else{var g=YAHOO.util.Dom.get("yui-gen0");YAHOO.util.Dom.addClass(g,"yui-button-disabled");YAHOO.util.Dom.get("search_to_update").value="";YAHOO.util.Dom.setStyle("advanced_search","display","none");YAHOO.util.Dom.setStyle("simple_search","display","");d.searchDialog.show()}}})}}},restoreSearchItemDialog:function(a){var b=this;function c(e){var d;if(YAHOO.lang.isString(e)){d=e.replace(/\+/g," ")}else{d=""}return d}this.getSearchItemParams(a,function(i){var n=i.rows.item(0);if(n.id!=="undefined"){var s=n,u=s.search_title,d=c(s.q),r=c(s.ands),k=c(s.ors),e=c(s.nots),g=c(s.phrase),t=c(s.tag),j=c(s.user_from),m=c(s.user_to),f=c(s.ref),p=s.pa,l=s.na,h=s.aq;YAHOO.util.Dom.get("title_of_search").value=u;YAHOO.util.Dom.get("q").value=d;YAHOO.util.Dom.get("ands").value=r;YAHOO.util.Dom.get("ors").value=k;YAHOO.util.Dom.get("nots").value=e;YAHOO.util.Dom.get("phrase").value=g;YAHOO.util.Dom.get("tag").value=t;YAHOO.util.Dom.get("from").value=j;YAHOO.util.Dom.get("to").value=m;YAHOO.util.Dom.get("ref").value=f;YAHOO.util.Dom.get("search_to_update").value=a;if(p==="true"){YAHOO.util.Dom.get("pa").checked=true}if(l==="true"){YAHOO.util.Dom.get("na").checked=true}if(h==="true"){YAHOO.util.Dom.get("aq").checked=true}if(d===""){YAHOO.util.Dom.setStyle("simple_search","display","none");YAHOO.util.Dom.setStyle("advanced_search","display","")}else{YAHOO.util.Dom.setStyle("advanced_search","display","none");YAHOO.util.Dom.setStyle("simple_search","display","")}var o=YAHOO.util.Dom.get("yui-gen0");YAHOO.util.Dom.removeClass(o,"yui-button-disabled")}})},addToTab:function(h){var f=new Date(h.created_at),c=f.toLocaleString(),e="",a=[];a[a.length]='<div class="tweet-container-left">';a[a.length]='<img height="48" width="48" class="profile_image" src="'+h.profile_image_url+'" alt="'+h.from_user+'" />';a[a.length]="</div>";a[a.length]='<div id="tweet-gid'+h.group_id+"-tid"+h.twitter_id+'" class="tweet-container-center">';a[a.length]='<p class="tweet_text" id="db_'+h.twitter_id+'">';a[a.length]='<a style="text-decoration: underline;" class="tweet_link" href="http://twitter.com/'+h.from_user+'">'+h.from_user+"</a>&nbsp;";a[a.length]=h.tweet_text;a[a.length]="</p>";a[a.length]='<p class="tweet-date">'+c+"</p>";a[a.length]="</div>";a[a.length]='<div class="tweet-container-right">';a[a.length]='<span title="Favorite this Tweet" class="fav_reply_remove fav_button" id="fav__'+h.twitter_id+"__"+h.from_user+'"></span>';a[a.length]='<span title="Reply to Tweet" class="fav_reply_remove reply_button reply_button" id="reply__'+h.twitter_id+"__"+h.from_user+'"></span>';a[a.length]="</div>";a[a.length]='<br class="clear" />';e=a.join("");var g=this.create("div");g.id="tweet__"+h.local_tweet_id+"__"+h.twitter_id;g.className="single-tweet detail-group-"+h.group_id+" search-term-"+h.searches_id;g.innerHTML=e;var b=this.findFirstTweet(h.group_id)||"undefined";YAHOO.util.Dom.insertBefore(g,b);var d=YAHOO.util.Dom.get(g.id);this.fadeThisIn(d);var i=YAHOO.util.Dom.get("emptygroup__"+h.group_id)||"undefined";if(i!=="undefined"){this.remove(i)}},removeSearchTermTweets:function(d,c){var b=this;var a="DELETE FROM tweets WHERE searches_id = "+Number(c);this.doQuery(a,[],function(f,e){var g,l="search-term-"+c,j="summary-group-"+d,k=YAHOO.util.Dom.getElementsByClassName(l,"div",j),h=k.length;for(g=0;g<h;g++){b.remove(k[g])}b.tabStore[d].totalTweetCount=b.tabStore[d].totalTweetCount-h;YAHOO.util.Dom.get("search_group_result_count").innerHTML="Search Group Total: "+b.tabStore[d].totalTweetCount})},getRawTabText:function(b){var a=b.replace(/<span.*><\/span>/,"");a=YAHOO.lang.trim(a.replace(/\(\d+\)/gi,""));return a},buildTabText:function(c,b){var d=this.getRawTabText(c),a=d;if(!YAHOO.lang.isUndefined(b)&&b>0){a+=" ("+b+")"}if(d!=="Trends"&&d!=="Favorites"){a+='<span class="close-search-group"></span>'}else{if(d==="Trends"){a+='<span id="trends-tab-label" class="active"></span>'}else{if(d==="Favorites"){a+='<span id="favs-tab-label" class="inactive"></span>'}}}return a},refreshTabStore:function(){var e=this,a,b,f,d=YAHOO.util.Selector.query("ul.yui-nav li a em");this.tabStore.tabCount=d.length;for(var c=0;c<d.length;c++){a=this.getRawTabText(d[c].innerHTML);if(a!=="Trends"){this.getGroupIdFromString(a,function(h,i){var g=Number(h.rows.item(0).id);e.getTweetCountForSearchGroup(g,function(k,j){if(YAHOO.lang.isUndefined(e.tabStore[g])){e.tabStore[g]={nodeReference:d[j.index],label:d[j.index].innerHTML,newTweetCount:0,totalTweetCount:k}}},{index:i.index})},{index:c})}}if(YAHOO.lang.isUndefined(this.tabStore.favoritesGrpID)){this.tabStore.favoritesGrpID=1}if(YAHOO.lang.isUndefined(this.tabStore.trendsGrpID)){this.tabStore.trendsGrpID=-1}YAHOO.util.Event.on(d,"dblclick",function(h){var g=YAHOO.util.Event.getTarget(h),i=e.getRawTabText(g.innerHTML);if(i!=="Trends"&&i!=="Favorites"){YAHOO.util.Dom.get("new_search_group_title").value=i;YAHOO.util.Dom.get("old_search_group_title").value=i;e.renameSearchGrpDialog.show()}})},updateActiveSearchList:function(c){var e,a="",f=YAHOO.util.Dom.get("active_search_strings");if(c.rows!==null){var b=c.rows.length||"undefined";for(e=0;e<b;e++){var g=c.rows.item(e).id,d=c.rows.item(e).search_title;a+='<li id="search__'+g+'" class="search_string_item">'+d+"</li>"}f.innerHTML=a}else{f.innerHTML='<li class="list_message">This group has no searches defined!</li>'}},doTwitterSearch:function(g,a,f,e,d){var c=this;var b=new XMLHttpRequest();b.onreadystatechange=function(){if(b.readyState===4){try{var h=YAHOO.lang.JSON.parse(b.responseText);g.call(c,h,f,e,d)}catch(i){Titanium.API.debug("Unabled to parse JSON")}}};b.open("GET",a,true);b.send(null)},fetchExternalJSONData:function(d,a){var c=this,b=new XMLHttpRequest();b.onreadystatechange=function(){if(b.readyState===4){try{var f=YAHOO.lang.JSON.parse(b.responseText);d.call(c,f)}catch(g){Titanium.API.debug("Unabled to parse JSON")}}};b.open("GET",a,true);b.send(null)},processNewTweets:function(t,l,n,s){var f=this;var p=0;this.rotationJobCount--;if(YAHOO.lang.isObject(t)&&YAHOO.lang.isObject(t.results)&&t.results.length>0){for(var o=t.results.length-1;o>=0;o--){var j,h,k=this.stripTags(t.results[o].text),r=t.results[o].to_user_id,d=t.results[o].from_user,g=t.results[o].id,c=t.results[o].from_user_id,b=t.results[o].profile_image_url,a=t.results[o].created_at,e=YAHOO.util.Dom.get("tweet-gid"+n+"-tid"+g)||"undefined";if(YAHOO.lang.isUndefined(e)||e==="undefined"){p=p+1;var q=new RegExp("((http|https|ftp|sftp)://.*)?("+l+")","gi");var m=k.replace(q,function(u,i){return i?u:'<span class="matched_search">'+u+"</span>"});m=m.replace(/((\w+):\/\/[\S]+\b)/gim,'<a title="open in browser" class="tweet_link" href="$1" target="_blank">$1</a>');m=m.replace(/@(\w+)/gim,'<a title="open in browser" class="tweet_link" href="http://twitter.com/$1" target="_blank">@$1</a>');this.addTweet(m,r,d,g,c,b,a,n,s,function(i,v){var u={local_tweet_id:i.rows.item(0).id,tweet_text:v.hightlighted_text,to_user_id:v.to_user_id,from_user:v.from_user,twitter_id:v.twitter_id,from_user_id:v.from_user_id,profile_image_url:v.profile_image_url,created_at:v.created_at,group_id:v.group_id,searches_id:v.searches_id};console.log(u.local_tweet_id);f.addToTab(u)},{hightlighted_text:m,to_user_id:r,from_user:d,twitter_id:g,from_user_id:c,profile_image_url:b,created_at:a,group_id:n,searches_id:s})}}this.getCurrentGrpId(function(i){f.tabStore[n].totalTweetCount+=p;f.rotationTotal+=p;if(n!==i){f.tabStore[n].newTweetCount+=p;f.tabStore[n].nodeReference.innerHTML=f.buildTabText(f.tabStore[n].label,f.tabStore[n].newTweetCount)}if(n!==f.tabStore.favoritesGrpID&&n!==f.tabStore.trendsGrpID){try{YAHOO.util.Dom.get("search_group_result_count").innerHTML="Search Group Total: "+f.tabStore[i].totalTweetCount}catch(u){}}if(f.showDesktopNotifications===1&&f.rotationJobCount===0&&f.rotationTotal>0){f.displaySearchResultNotification(f.rotationTotal)}f.getMaxTwitterIdForSearchTerm(s,function(v){if(!YAHOO.lang.isNull(t)){f.updateMaxTwitterIdForSearchTerm(v.rows.item(0).twitter_id,s)}})})}},handleTweetReplyFavRemove:function(c){var e=c.id.split("__"),f=e[0],n=e[1],j=e[2],h=this.tabStore.favoritesGrpID,b="summary-group-"+h,m,d;if(f==="reply"){this.openInBrowser("http://twitter.com/home?status=@"+j)}else{if(f==="remove"){m=c.parentNode;d=m.parentNode;this.fadeThisOut(d,true);this.removeTweet(n);if(YAHOO.util.Dom.getChildren(b).length<=1){YAHOO.util.Dom.get(b).innerHTML='<p id="emptygroup__'+h+'">This group has no search results yet!</p>'}}else{if(f==="fav"){c.id="remove__"+n+"__"+j;YAHOO.util.Dom.replaceClass(c,"fav_button","delete_button");m=c.parentNode;d=m.parentNode;var l=YAHOO.util.Dom.get(d).cloneNode(true),k=YAHOO.util.Dom.get(d).className,g="emptygroup__"+h,i=YAHOO.util.Dom.get(g)||"undefined";YAHOO.util.Dom.replaceClass(l,k,"single-tweet detail-group-"+h);if(i==="undefined"){var a=this.findFirstTweet(h)||"undefined";YAHOO.util.Dom.insertBefore(l,a)}else{YAHOO.util.Dom.insertAfter(l,i);this.remove(i)}YAHOO.util.Dom.setStyle(c,"visibility","hidden");this.markAsFavorite(n)}}}},fadeThisOut:function(b,c){var d=this,a;a=new YAHOO.util.Anim(b,{opacity:{to:0}},1,YAHOO.util.Easing.easeOut);a.animate();a.onComplete.subscribe(function(){if(c===true){d.remove(b)}else{YAHOO.util.Dom.setStyle(b,"display","none")}})},fadeThisIn:function(c){var b={backgroundColor:{from:"#FFFF99",to:"#171717"}};var a=new YAHOO.util.ColorAnim(c,b);a.animate()},setupTooltip:function(){var a=new YAHOO.widget.Overlay("tooltip",{context:["ctt","tl","br"],visible:false,fixedcenter:true,width:"300px",height:"auto",underlay:"shadow"});a.render();YAHOO.util.Event.addListener("information","mouseover",a.show,a,true);YAHOO.util.Event.addListener("information","mouseout",a.hide,a,true)},setupRefreshRateSlider:function(){var a="slider-bg",d="slider-converted-value",b=18,c=20;YAHOO.TI.Sideline.slider=YAHOO.widget.Slider.getHorizSlider("slider-bg","slider-thumb",0,200,20);YAHOO.TI.Sideline.slider.animate=true;YAHOO.TI.Sideline.slider.setValue((this.searchRefreshRate/6)*20,false);YAHOO.TI.Sideline.slider.getRealValue=function(){var e=Math.round(this.getValue()*b)/60;if(e===0){e=1}return e};YAHOO.TI.Sideline.slider.subscribe("change",function(g){var e=YAHOO.util.Dom.get(d),f=YAHOO.TI.Sideline.slider.getRealValue();e.innerHTML=f;YAHOO.util.Dom.get(a).title="slider value = "+f})},setupSearchRateDialog:function(){var b=this;var a=function(){b.searchRefreshRate=Number(YAHOO.lang.trim(YAHOO.util.Dom.get("slider-converted-value").innerHTML));b.saveUserPreferences();b.doIntermediateDataRotation.call(b);this.cancel()};var c=function(){YAHOO.TI.Sideline.slider.setValue((b.searchRefreshRate/6)*20,false);this.cancel()};this.searchRateDialog=new YAHOO.widget.Dialog("search_rate_dialog",{width:"250px",fixedcenter:true,visible:false,modal:true,draggable:false,underlay:"none",postmethod:"none",constraintoviewport:true,buttons:[{text:"Submit",handler:a},{text:"Cancel",handler:c}]});this.searchRateDialog.render();YAHOO.util.Event.addListener("search_rate_dialog","keypress",function(d){if(d.keyCode&&d.keyCode===13){YAHOO.util.Event.preventDefault(d)}})},findFirstTweet:function(a){var b=YAHOO.util.Dom.get("summary-group-"+a)||"undefined";if(b!=="undefined"){var c=YAHOO.util.Dom.getFirstChild(b)||"undefined";if(c!=="undefined"){return c}}return false},getCurrentGrpId:function(e){var d,c=this,a=YAHOO.util.Selector.query("li.selected a em"),b=this.getRawTabText(a[0].innerHTML);if(b==="Trends"){e.call(this,-1)}else{if(b==="Favorites"){e.call(this,1)}else{this.getGroupIdFromString(b,function(f){if(f.rows.length<=0){e.call(c,"undefined")}else{e.call(c,f.rows.item(0).id)}})}}}};YAHOO.TI.SidelineUtil=function(){};YAHOO.TI.SidelineUtil.prototype={openInBrowser:function(a){Titanium.Desktop.openURL(a)},dataRotation:function(){var a=this;this.getAllSidelineGroups(function(e){var b,d="http://search.twitter.com/search.json?",c=e.rows.length;a.getCountOfActiveQueries(function(g){a.rotationJobCount=g;a.rotationTotal=0;if(c>0){a.doProgressIndicator(1);for(b=0;b<c;b++){var f=e.rows.item(b);a.getSidelineGroupQueries(f.id,function(i){var k,l,m,p,o=0;if(i.rows!==null){o=i.rows.length;for(k=0;k<o;k++){var h=i.rows.item(k);l=d+h.actual_query_string+"&lang=en";if(h.twitter_starting_point!==""&&h.twitter_starting_point>0){l+="&since_id="+h.twitter_starting_point}p="";if(h.q!==""){m=h.q;if(m.charAt(0)==='"'){m=m.substr(1,m.length)}if(m.charAt(m.length-1)==='"'){m=m.substr(0,m.length-1)}m=m.replace(/\+or\+/gi,"|");m=m.replace(/\+/g,"|");p+=m.replace(/"\|"/g,"|")}if(h.ands!==""){p+=h.ands.replace(/\+/ig,"|")}if(h.ors!==""){p+=h.ors.replace(/\+/ig,"|")}if(h.phrase!==""){p+=h.phrase.replace(/\+/ig," ")}if(h.tag!==""){p+=h.tag.replace(/\+/ig," ")}if(h.user_from!==""){p+=h.user_from.replace(/\+/ig," ")}if(h.user_to!==""){p+=h.user_to.replace(/\+/ig," ")}if(h.ref!==""){p+=h.ref.replace(/\+/ig," ")}try{a.doTwitterSearch(a.processNewTweets,encodeURI(l).replace(/#/g,"%23"),p,f.id,h.id)}catch(n){}}}if(e.rows.length==b){a.doProgressIndicator(0)}})}}})})},getTwitterTrends:function(){try{this.fetchExternalJSONData(function(j){if(YAHOO.lang.isObject(j)&&YAHOO.lang.isObject(j.trends)&&j.trends.length>0){var b="",c=[],f=new Date(j.as_of),e=f.toLocaleString(),h=YAHOO.util.Dom.get("twitter_trend_list"),d=YAHOO.util.Dom.get("twitter_trend_asof");for(var g=0;g<j.trends.length;g++){c[g]='<div class="trend_node"><div class="trend_preview_header"><img class="trend_arrow closed" src="../images/closed_arrow.png" alt="closed" /><span class="trend_title">&nbsp;'+j.trends[g].name+'</span><a title="'+j.trends[g].name+'" class="trend_item" href="'+j.trends[g].url+'"></a></div><div id="trend_item_'+g+'" class="trend_preview_container" rel="'+j.trends[g].url+'&rpp=3"></div></div>'}b=c.join("");h.innerHTML=b;d.innerHTML="Note: these are as of "+e}},"http://search.twitter.com/trends.json")}catch(a){}},handleTrendEvents:function(g,f){var d=this;var c=YAHOO.util.Event.getTarget(g);if(YAHOO.util.Dom.hasClass(c,"trend_arrow")){var h=YAHOO.util.Dom.getNextSibling(c.parentNode),a=YAHOO.util.Dom.getAttribute(h,"id"),b=YAHOO.util.Dom.getAttribute(h,"rel"),k=b.replace("http://search.twitter.com/search?","http://search.twitter.com/search.json?");if(YAHOO.util.Dom.hasClass(c,"closed")){c.setAttribute("src","../images/open_arrow.png");h.innerHTML='<img src="../images/search_in_progress.gif" alt="search in progress" />';YAHOO.util.Dom.replaceClass(c,"closed","open");YAHOO.util.Dom.setStyle(h,"display","block");var i=new XMLHttpRequest();i.onreadystatechange=function(){if(i.readyState===4){try{var l=YAHOO.lang.JSON.parse(i.responseText);f.updateTrendPreview(l,a,f.tabStore.trendsGrpID)}catch(m){}}};i.open("GET",k,true);i.send(null)}else{c.setAttribute("src","../images/closed_arrow.png");YAHOO.util.Dom.replaceClass(c,"open","closed");YAHOO.util.Dom.setStyle(h,"display","none")}}else{if(YAHOO.util.Dom.hasClass(c,"trend_item")){YAHOO.util.Event.preventDefault(g);var j=c.title;d.addNewSearchGroup(j,function(p){var l,o,n=c.href,r=n.split("?q="),q=decodeURIComponent(r[1]),m="q="+q+"&ands=&phrase=&ors=&nots=&tag=&from=&to=&ref=&rpp=100",e=p.rows.item(0).id;if(p.data!==null){o={group_id:e,search_title:j,actual_query_string:m,q:q,ands:"",ors:"",nots:"",phrase:"",tag:"",user_from:"",user_to:"",ref:"",pa:"false",na:"false",aq:"false"};d.addSearchItem(o);l=d.buildTabText(j);d.tabView.addTab(new YAHOO.widget.Tab({label:l,active:false,content:'<div id="summary-group-'+e+'" class="tweet-container summary-group-'+e+'"><p id="emptygroup__'+e+'">This group has no search results yet!</p><div>'}));d.remove(YAHOO.util.Dom.get("add_new_group"));d.refreshTabStore();d.setupNewTabButton();d.tabView.set("activeIndex",this.tabStore.tabCount-1);d.doIntermediateDataRotation()}})}}},updateTrendPreview:function(c,h,g){var b,f,e=[],a=YAHOO.util.Dom.get(h);for(var d=0;d<c.results.length;d++){b=c.results[d].text;b=b.replace(/((\w+):\/\/[\S]+\b)/gim,'<a title="open in browser" class="tweet_link" href="$1" target="_blank">$1</a>');b=b.replace(/@(\w+)/gim,'<a title="open in browser" class="tweet_link" href="http://twitter.com/$1" target="_blank">@$1</a>');e[e.length]="<div>";e[e.length]='<div class="tweet-preview-container-left">';e[e.length]='<img height="48" width="48" class="profile_image" src="'+c.results[d].profile_image_url+'" alt="'+c.results[d].from_user+'" />';e[e.length]="</div>";e[e.length]='<div class="tweet-preview-container-center">';e[e.length]='<p class="tweet_text" id="db_'+c.results[d].id+'">';e[e.length]='<a title="open in browser" style="text-decoration: underline;" class="tweet_link" href="http://twitter.com/'+encodeURIComponent(c.results[d].from_user)+'">'+c.results[d].from_user+"</a>&nbsp;"+b;e[e.length]="</p>";e[e.length]='<p class="tweet-date">'+c.results[d].created_at+"</p>";e[e.length]="</div>";e[e.length]='<br class="clear" />';e[e.length]="</div>";e[e.length]='<br class="clear" />'}f=e.join("");a.innerHTML=f},processSearchDialogData:function(a){var b=this.stripTags(YAHOO.lang.trim(a));return b.replace(/ /gi,"+")},displaySearchResultNotification:function(){},importSearchGrps:function(){alert("Search import not yet implemented...")},doProgressIndicator:function(a){if(a===1){YAHOO.util.Dom.setStyle("search_progress_indicator","visibility","visible")}else{setTimeout(function(){YAHOO.util.Dom.setStyle("search_progress_indicator","visibility","hidden")},1000)}},stripTags:function(a){if(YAHOO.lang.isString(a)){return a.replace(/<\/?[a-z0-9]+>/gim,"")}},create:function(a){return document.createElementNS?document.createElementNS("http://www.w3.org/1999/xhtml",a):document.createElement(a)},remove:function(b){var a=b;if(YAHOO.lang.isString(a)){a=YAHOO.util.Dom.get(a)||"undefined"}if(a!=="undefined"){try{a.parentNode.removeChild(a)}catch(c){}}}};YAHOO.TI.SidelineDB=function(){};YAHOO.TI.SidelineDB.prototype={db:null,doQuery:function(d,b,c,a){if(typeof d==="undefined"){throw"SQL Query string is required, dummy."}if(typeof b==="undefined"){b=[]}if(typeof c==="undefined"){c=function(f,e){}}if(typeof a==="undefined"){a=function(e,f){Titanium.API.debug(f+": "+f.message);window.console.log("Error doing query: "+d);window.console.log(f+": "+f.message)}}this.db.transaction(function(e){e.executeSql(d,b,c,a)})},initDb:function(c){var a=this;var b={createSearchGroups:"CREATE TABLE IF NOT EXISTS search_groups(id INTEGER PRIMARY KEY NOT NULL, group_name TEXT NOT NULL,active TEXT NOT NULL DEFAULT 'Y');",createSearches:"CREATE TABLE IF NOT EXISTS searches(id INTEGER PRIMARY KEY NOT NULL, group_id INTEGER NOT NULL, search_title TEXT NOT NULL,actual_query_string TEXT,q TEXT,ands TEXT,ors TEXT,nots TEXT,phrase TEXT,tag TEXT,user_from TEXT,user_to TEXT,ref TEXT,pa TEXT,na TEXT,aq TEXT,twitter_starting_point INTEGER,active TEXT DEFAULT 'Y');",createTweets:"CREATE TABLE IF NOT EXISTS tweets(id INTEGER PRIMARY KEY NOT NULL,text TEXT,to_user_id INTEGER,from_user TEXT,twitter_id INTEGER,from_user_id INTEGER,profile_image_url TEXT,created_at TEXT,searches_id INTEGER,sideline_group_id INTEGER,loaded_at DATETIME DEFAULT CURRENT_TIMESTAMP);",createUserPreferences:"CREATE TABLE IF NOT EXISTS user_preferences(show_desktop_notifications INTEGER NOT NULL DEFAULT 1, refresh_rate INTEGER NOT NULL DEFAULT 1);",selectAllSearchGroups:"SELECT * FROM search_groups",insertGroup:"INSERT INTO search_groups(id,group_name,active) VALUES (1,'Favorites', 'Y');",selectAllPrefs:"SELECT * FROM user_preferences",insertPrefs:"INSERT INTO user_preferences(show_desktop_notifications,refresh_rate) VALUES (1,1);"};a.doQuery(b.createSearchGroups,[],function(e,d){a.doQuery(b.createSearches,[],function(g,f){a.doQuery(b.createTweets,[],function(i,h){a.doQuery(b.createUserPreferences,[],function(k,j){a.doQuery(b.selectAllPrefs,[],function(m,l){if(l.rows.length>0){a.doQuery(b.selectAllSearchGroups,[],function(o,n){if(n.rows.length>0){c.call(a)}else{a.doQuery(b.insertGroup,[],function(q,p){c.call(a)})}})}else{a.doQuery(b.insertPrefs,[],function(o,n){a.doQuery(b.selectAllSearchGroups,[],function(q,p){if(p.rows.length>0){c.call(a)}else{a.doQuery(b.insertGroup,[],function(s,r){c.call(a)})}})})}})})})})})},dbCleanup:function(){var a="DELETE FROM tweets WHERE strftime('%Y-%m-%d %H:%M:%S', loaded_at) < strftime('%Y-%m-%d %H:%M:%S', datetime('now'), '-3 hours') AND sideline_group_id <> 1";this.doQuery(a)},addNewSearchGroup:function(f,e){var d,c=this,b=[f],a="INSERT INTO search_groups VALUES (NULL, ?, 'Y')";this.doQuery(a,b,function(h,g){c.doQuery("SELECT last_insert_rowid() as id",[],function(i,j){e.call(this,j)})})},updateSearchGroup:function(b,a,d){var c=this;this.getGroupIdFromString(b,function(e){var h=e.rows.item(0).id;var g=[];var f="UPDATE search_groups SET group_name = ? WHERE id = ?";g[g.length]=a;g[g.length]=h;c.doQuery(f,g,function(j,i){d.call(this,h)})})},getTweets:function(c,e,d){var b=[Number(c)],a="SELECT id, text, from_user, twitter_id, profile_image_url, created_at, sideline_group_id, searches_id FROM tweets WHERE sideline_group_id = ? ORDER BY twitter_id DESC";this.doQuery(a,b,function(g,f){e.call(this,f,d)})},getTweetCountForSearchGroup:function(d,f,e){var c=0,b=[Number(d)],a="SELECT count(id) AS tweet_count FROM tweets WHERE sideline_group_id = ?";this.doQuery(a,b,function(h,g){if(g!==null&&g.rows.length===1){f.call(this,Number(g.rows.item(0).tweet_count),e)}})},getSearchItemParams:function(b,d){var c=[Number(b)],a="SELECT id, group_id, search_title, q, ands, ors, nots, phrase, tag, user_from, user_to, ref, pa, na, aq FROM searches WHERE id = ?";this.doQuery(a,c,function(f,e){d.call(this,e)})},markAsFavorite:function(c){var b=[Number(c)],a="UPDATE tweets SET sideline_group_id = "+this.tabStore.favoritesGrpID+" WHERE twitter_id = ?";this.doQuery(a,b)},getUserPreferences:function(b){var a="SELECT show_desktop_notifications, refresh_rate FROM user_preferences";this.doQuery(a,[],function(d,c){b.call(this,c)})},saveUserPreferences:function(){var b=[],a="UPDATE user_preferences SET show_desktop_notifications = ? , refresh_rate = ?";b[b.length]=Number(this.showDesktopNotifications);b[b.length]=Number(this.searchRefreshRate);this.doQuery(a,b)},addTweet:function(m,g,i,n,c,j,a,k,f,l,b){var h=this,d=[],e="INSERT INTO tweets (text, to_user_id, from_user, twitter_id, from_user_id, profile_image_url, created_at, sideline_group_id, searches_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)";d[d.length]=m;d[d.length]=Number(g);d[d.length]=i;d[d.length]=Number(n);d[d.length]=Number(c);d[d.length]=j;d[d.length]=a;d[d.length]=Number(k);d[d.length]=Number(f);this.doQuery(e,d,function(p,o){h.doQuery("SELECT * FROM tweets WHERE text = ? AND to_user_id = ? AND from_user = ? AND twitter_id = ? AND from_user_id = ? AND profile_image_url = ? AND created_at = ? AND sideline_group_id = ? AND searches_id = ?",d,function(r,q){l.call(this,q,b)})})},removeTweet:function(c){var b=[Number(c)],a="DELETE FROM tweets WHERE twitter_id = ?";this.doQuery(a,b)},removeTabData:function(c){var b=[Number(c)],e="DELETE FROM searches WHERE group_id = ?",a="DELETE FROM tweets WHERE sideline_group_id = ?",d="DELETE FROM search_groups WHERE id = ?";this.doQuery(e,b);this.doQuery(a,b);this.doQuery(d,b)},getGroupIdFromString:function(d,e,c){var b=[d],a="SELECT id FROM search_groups WHERE group_name = ?";this.doQuery(a,b,function(g,f){e.call(this,f,c)})},getSidelineGroupQueries:function(c,d){var b=[Number(c)],a="SELECT id, group_id, search_title, actual_query_string, q, ands, ors, nots, phrase, tag, user_from, user_to, ref, twitter_starting_point FROM searches WHERE active='Y' AND group_id = ?";this.doQuery(a,b,function(f,e){d.call(this,e)})},getCountOfActiveQueries:function(c){var a="SELECT count(id) as total_search_count FROM searches WHERE active='Y'",b=0;this.doQuery(a,[],function(e,d){if(d!==null&&d.rows.length===1){c.call(this,Number(d.rows.item(0).total_search_count))}})},getMaxTwitterIdForSearchTerm:function(c,d){var b=[Number(c)],a="SELECT MAX(twitter_id) as twitter_id FROM tweets WHERE searches_id = ?";this.doQuery(a,b,function(f,e){d.call(this,e)})},updateMaxTwitterIdForSearchTerm:function(c,d){var b=[];var a="UPDATE searches SET twitter_starting_point = ? WHERE id = ?";b[b.length]=Number(c);b[b.length]=Number(d);this.doQuery(a,b)},getAllSidelineGroups:function(b){var a="SELECT id, group_name FROM search_groups WHERE active='Y' ORDER BY id ASC";this.doQuery(a,[],function(d,c){b.call(this,c)})},getSidelineGroup:function(c,b){var a="SELECT * FROM search_groups WHERE id = ? ORDER BY id ASC";this.doQuery(a,[c],function(e,d){b.call(this,d)})},removeSearchItem:function(c){var b=[Number(c)],a="DELETE FROM searches WHERE id = ?";this.doQuery(a,b)},addSearchItem:function(d,f){var e,c=this,b=[],a="INSERT INTO searches (id, group_id, search_title, actual_query_string, q, ands, ors, nots, phrase, tag, user_from, user_to, ref, pa, na, aq, twitter_starting_point, active) VALUES (null, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 0, 'Y')";b[b.length]=Number(d.group_id);b[b.length]=d.search_title;b[b.length]=d.actual_query_string;b[b.length]=d.q;b[b.length]=d.ands;b[b.length]=d.ors;b[b.length]=d.nots;b[b.length]=d.phrase;b[b.length]=d.tag;b[b.length]=d.user_from;b[b.length]=d.user_to;b[b.length]=d.ref;b[b.length]=d.pa;b[b.length]=d.na;b[b.length]=d.aq;this.doQuery(a,b,function(h,g){c.doQuery("SELECT last_insert_rowid() as id",[],function(j,i){f.call(this,i)})})},updateSearchItem:function(d,c,e){var b=[],a="UPDATE searches set search_title = ?, actual_query_string = ?, q = ?, ands = ?, ors = ?, nots = ?, phrase = ?, tag = ?, user_from = ?, user_to = ?, ref = ?, pa = ?, na = ?, aq = ?, twitter_starting_point = 0 WHERE id = ?";b[b.length]=c.search_title;b[b.length]=c.actual_query_string;b[b.length]=c.q;b[b.length]=c.ands;b[b.length]=c.ors;b[b.length]=c.nots;b[b.length]=c.phrase;b[b.length]=c.tag;b[b.length]=c.user_from;b[b.length]=c.user_to;b[b.length]=c.ref;b[b.length]=c.pa;b[b.length]=c.na;b[b.length]=c.aq;b[b.length]=d;this.doQuery(a,b,function(g,f){e.call(this,f)})}};(function(){YAHOO.namespace("widget.alert");var a=window.alert;window.alert=function(b){YAHOO.widget.alert.dlg.setBody(b);YAHOO.widget.alert.dlg.cfg.queueProperty("icon",YAHOO.widget.SimpleDialog.ICON_WARN);YAHOO.widget.alert.dlg.cfg.queueProperty("zIndex",9999);YAHOO.widget.alert.dlg.render(document.body);if(YAHOO.widget.alert.dlg.bringToTop){YAHOO.widget.alert.dlg.bringToTop()}YAHOO.widget.alert.dlg.show()};YAHOO.util.Event.on(window,"load",function(){var b=function(){this.hide()};YAHOO.widget.alert.dlg=new YAHOO.widget.SimpleDialog("widget_alert",{visible:false,width:"20em",zIndex:9999,close:false,fixedcenter:true,modal:false,underlay:"none",draggable:false,constraintoviewport:true,icon:YAHOO.widget.SimpleDialog.ICON_WARN,buttons:[{text:"OK",handler:b}]});YAHOO.widget.alert.dlg.setHeader("Alert!");YAHOO.widget.alert.dlg.setBody("Alert body passed to window.alert");YAHOO.widget.alert.dlg.render(document.body)})})();(function(){var a=new YAHOO.TI.Sideline();YAHOO.lang.augment(YAHOO.TI.Sideline,YAHOO.TI.SidelineDB);YAHOO.lang.augment(YAHOO.TI.Sideline,YAHOO.TI.SidelineUtil);a.db=openDatabase("ti_sideline","1.0","Sideline",200000);a.initDb(function(){a.getUserPreferences(function(c){if(!YAHOO.lang.isNull(c)&&!YAHOO.lang.isNull(c.rows)&&c.rows.length>0){var b=c.rows.item(0);a.showDesktopNotifications=b.show_desktop_notifications;a.searchRefreshRate=b.refresh_rate}else{a.showDesktopNotifications=1;a.searchRefreshRate=1}a.tabView=new YAHOO.widget.TabView();a.setupSidelineTabs();a.setupTooltip();a.setupRefreshRateSlider();a.searchDialogBuilder();a.searchGrpDialogBuilder();a.renameSearchGrpDialogBuilder();a.searchGrpRemovalDialog();a.setupSearchRateDialog();a.setupMenu();a.dbCleanup();setInterval(function(){a.dbCleanup()},10860000);a.getTwitterTrends();setInterval(function(){a.getTwitterTrends()},300000);a.dataRotation();a.rotationTimer=setInterval(function(){a.dataRotation()},a.searchRefreshRate*60000);YAHOO.util.Event.on("active_search_container","click",a.activeSearchHandler,a,true);YAHOO.util.Event.on("twitter_trend_list","click",a.handleTrendEvents,a,true);YAHOO.util.Event.on("tweetainer","click",function(f){var d=YAHOO.util.Event.getTarget(f);if(YAHOO.util.Dom.hasClass(d,"close-search-group")){a.searchGrpRemoval.show()}else{if(YAHOO.util.Dom.hasClass(d,"fav_reply_remove")){a.handleTweetReplyFavRemove(d)}else{if(YAHOO.util.Dom.hasClass(d,"tweet_link")){YAHOO.util.Event.preventDefault(f);a.openInBrowser(d.href)}}}});YAHOO.util.Event.on("yui_link","click",function(f){YAHOO.util.Event.preventDefault(f);var d=YAHOO.util.Event.getTarget(f);a.openInBrowser(d.href)});YAHOO.util.Event.on("manual_refresh","click",function(){a.doIntermediateDataRotation.call(a)},a,true)})})})()});